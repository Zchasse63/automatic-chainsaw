[build]
  command = "bun install --frozen-lockfile && npx next build"
  publish = ".next"

[build.environment]
  # Pin Bun version to match local dev (Netlify only auto-detects bun.lockb, not bun.lock)
  BUN_VERSION = "1.3.9"
  # Skip npm auto-install since we run bun install explicitly in the build command
  NPM_FLAGS = "--prefix=/dev/null"

[[plugins]]
  package = "@netlify/plugin-nextjs"

[functions]
  node_bundler = "esbuild"
  external_node_modules = ["openai"]
  # IMPORTANT: Set function timeout to 60s in Netlify dashboard
  # (Site settings → Functions → Background functions timeout)
  # The chat AI route with tool calls can take 15-40s; default 10-26s is too short.

# Environment variables are set in the Netlify dashboard
# Required:
#   NEXT_PUBLIC_SUPABASE_URL
#   NEXT_PUBLIC_SUPABASE_ANON_KEY
#   OPENAI_API_KEY
#   XAI_API_KEY
